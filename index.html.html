<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Skoolee ‚Äì School System</title>
<style>
body{
  margin:0; font-family:Arial; background:linear-gradient(135deg,#e8f0ff,#e8fff3);
  display:flex; justify-content:center; align-items:center; min-height:100vh;
}
.box{
  background:#fff; width:95%; max-width:1100px; padding:20px;
  border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.15);
}
.hidden{display:none;}
input,select,button,textarea{
  padding:8px; margin:6px 0; border-radius:10px; border:1px solid #ccc;
}
button{cursor:pointer; background:#6c63ff; color:#fff; border:none;}
button.red{background:#e53935;} 
button.green{background:#43a047;}
.card{border:1px solid #e5e7eb; padding:14px; border-radius:14px; margin:12px 0; background:#fafbff;}
.merit{color:#2e7d32;} .demerit{color:#c62828;}
hr{margin:18px 0;}
.long{max-width:900px;}
.student-card{
  display:grid; grid-template-columns:120px 1fr; gap:16px; align-items:flex-start;
}
.avatar{
  width:120px; height:120px; border-radius:14px; background:#eef2ff; display:flex;
  align-items:center; justify-content:center; overflow:hidden; border:1px solid #e5e7eb;
}
.avatar img{width:100%; height:100%; object-fit:cover;}
.badge{display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; background:#eef2ff; margin-right:6px;}
.att-present{background:#e8f5e9; color:#1b5e20;}
.att-absent{background:#ffebee; color:#b71c1c;}
.att-late{background:#fff8e1; color:#e65100;}
.toolbar{display:flex; gap:8px; flex-wrap:wrap;}
.small{font-size:12px; color:#666;}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="box" id="loginBox">
<div style="display:flex;justify-content:space-between;align-items:center;">
  <img src="https://img.sanishtech.com/u/cbab5efb1081d570bcd09bb2119fd32a.png" alt="School Logo" style="height:60px;">
  <div style="text-align:center;">
    <div style="width:80px;height:80px;border-radius:50%;overflow:hidden;margin:auto;">
      <img src="https://img.sanishtech.com/u/39ac331ad706e432d87a9b2dac8871f1.gif" style="width:100%;height:100%;object-fit:cover;">
    </div>
    <div style="font-size:14px;font-weight:bold;margin-top:6px;">WELCOME TO MHMD SCHOOL!</div>
  </div>
</div>
<hr>
<h2>Skoolee School Login</h2>
<input id="loginId" placeholder="ID">
<div style="display:flex;gap:8px;align-items:center;">
  <input id="loginPass" type="password" placeholder="Password" style="flex:1">
  <button type="button" onclick="togglePassword()" title="Show / Hide Password">üëÅÔ∏è</button>
</div>
<button onclick="login()">Login</button>
<p id="loginError" style="color:red;display:none">Wrong ID or Password</p>
</div>

<!-- TEACHER DASHBOARD -->
<div class="box hidden" id="teacherBox">
<img src="https://img.sanishtech.com/u/cbab5efb1081d570bcd09bb2119fd32a.png" alt="School Logo" style="height:60px;margin-bottom:10px;">
<h2>üë©‚Äçüè´ Teacher Dashboard</h2>

<h3>Add Class</h3>
<input id="className" placeholder="Class name">
<button onclick="addClass()">Add Class</button>

<div id="classList"></div>
<hr>
<button class="red" onclick="logout()">Logout</button>
</div>

<!-- STUDENT DASHBOARD -->
<div class="box hidden long" id="studentBox">
<img src="https://img.sanishtech.com/u/cbab5efb1081d570bcd09bb2119fd32a.png" alt="School Logo" style="height:60px;margin-bottom:10px;">
<h2>üßë‚Äçüéì Student Dashboard</h2>
<div id="studentInfo"></div>
<button class="red" onclick="logout()">Logout</button>
</div>

<script>
// ===== STORAGE =====
let data = JSON.parse(localStorage.getItem("skoolee")) || {classes:{},students:{}};
const teacherID = "teacher123";
const teacherPASS = "teaching2026";
function save(){localStorage.setItem("skoolee",JSON.stringify(data));}

function togglePassword(){
  const p = document.getElementById("loginPass");
  p.type = p.type === "password" ? "text" : "password";
}

// ===== LOGIN =====
function login(){
  let id=loginId.value, pass=loginPass.value;
  loginError.style.display="none";

  if(id===teacherID && pass===teacherPASS){
    loginBox.classList.add("hidden");
    teacherBox.classList.remove("hidden");
    renderClasses();
  }
  else if(data.students[id] && data.students[id].pass===pass){
    loginBox.classList.add("hidden");
    studentBox.classList.remove("hidden");
    showStudent(id);
  }
  else loginError.style.display="block";
}

function logout(){
  teacherBox.classList.add("hidden");
  studentBox.classList.add("hidden");
  loginBox.classList.remove("hidden");
}

// ===== TEACHER FUNCTIONS =====
function addClass(){
  let name=className.value.trim();
  if(!name || data.classes[name]) return;
  data.classes[name]=[];
  save(); className.value=""; renderClasses();
}

function deleteClass(name){
  data.classes[name].forEach(id=>delete data.students[id]);
  delete data.classes[name]; save(); renderClasses();
}

function safeId(text){ return text.replace(/[^a-zA-Z0-9_]/g,'_'); }

function renderClasses(){
  classList.innerHTML="";
  for(let c in data.classes){
    let sid = safeId(c);
    let div=document.createElement("div"); div.className="card";
    div.innerHTML=`<b>Class:</b> ${c}<br>
    <div class='toolbar'>
      <button onclick=\"addStudentForm('${c}')\">Add Student</button>
      <button class='red' onclick=\"deleteClass('${c}')\">Delete Class</button>
    </div>
    <div id='form_${sid}' class='small'></div>
    <div id='cls_${sid}'></div>`;
    classList.appendChild(div);
    renderStudents(c);
  }
}

// --- INLINE ADD STUDENT (NO PROMPT) ---
function addStudentForm(cls){
  const sid = safeId(cls);
  const form = document.getElementById(`form_${sid}`);
  form.innerHTML = `
    <div class='card'>
      <b>Add Student</b><br>
      <input id='st_name_${sid}' placeholder='Student name'>
      <input id='st_photo_${sid}' type='file' accept='image/*'>
      <button onclick=\"createStudent('${cls}')\">Create</button>
    </div>`;
}

function createStudent(cls){
  const sid = safeId(cls);
  const nameEl = document.getElementById(`st_name_${sid}`);
  const fileEl = document.getElementById(`st_photo_${sid}`);
  const name = nameEl.value.trim();
  if(!name) return;

  const id = "S"+Math.floor(1000+Math.random()*9000);
  const pass = "P"+Math.floor(1000+Math.random()*9000);

  const finish = (photo)=>{
    data.students[id]={name,pass,class:cls,attendance:"-",merits:[],demerits:[],profile:"",photo};
    data.classes[cls].push(id);
    save();
    alert(`Student Created\nID: ${id}\nPassword: ${pass}`);
    document.getElementById(`form_${sid}`).innerHTML='';
    renderStudents(cls);
  };

  if(fileEl.files && fileEl.files[0]){
    const reader = new FileReader();
    reader.onload = e => finish(e.target.result);
    reader.readAsDataURL(fileEl.files[0]);
  } else {
    finish(null);
  }
}

function renderStudents(cls){
  let sid = safeId(cls);
  let box=document.getElementById(`cls_${sid}`);
  if(!box) return;
  box.innerHTML="";
  data.classes[cls].forEach(id=>{
    let s=data.students[id];
    let div=document.createElement("div"); div.className="card";
    div.innerHTML=`
    <b>${s.name}</b> <span class='small'>(ID: ${id})</span><br>
    Attendance:
    <select onchange=\"setAttendance('${id}',this.value)\">
      <option>-</option>
      <option ${s.attendance==='Present'?'selected':''}>Present</option>
      <option ${s.attendance==='Absent'?'selected':''}>Absent</option>
      <option ${s.attendance==='Late'?'selected':''}>Late</option>
    </select><br>
    <div class='toolbar'>
      <button class='green' onclick=\"addMerit('${id}')\">Add Merit</button>
      <button class='red' onclick=\"addDemerit('${id}')\">Add Demerit</button>
      <button onclick=\"editProfile('${id}')\">Edit Profile</button>
    </div>`;
    box.appendChild(div);
  });
}

function setAttendance(id,val){ data.students[id].attendance=val; save(); }
function addMerit(id){ let r=prompt("Merit reason"); if(r){data.students[id].merits.push(r); save();}}
function addDemerit(id){ let r=prompt("Demerit reason"); if(r){data.students[id].demerits.push(r); save();}}
function editProfile(id){ let p=prompt("Student profile info"); if(p!==null){data.students[id].profile=p; save();}}

// ===== STUDENT VIEW (CLEAN & SMOOTH) =====
function showStudent(id){
  let s=data.students[id];
  let attClass = s.attendance==='Present'?'att-present':s.attendance==='Absent'?'att-absent':s.attendance==='Late'?'att-late':'';
  studentInfo.innerHTML=`
  <div class='card student-card'>
    <div class='avatar'>${s.photo?`<img src='${s.photo}'>`:'üì∑'}</div>
    <div>
      <h3 style='margin:0 0 6px'>${s.name}</h3>
      <div class='small'>Class: ${s.class}</div><br>
      <span class='badge'>ID: ${id}</span>
      <span class='badge'>Password: ${s.pass}</span>
      <span class='badge ${attClass}'>${s.attendance}</span>
      <br><br>
      <b>Profile</b><br>${s.profile || 'No profile'}<br><br>
      <b>Merits</b>${s.merits.length? s.merits.map(m=>`<div class='merit'>‚Ä¢ ${m}</div>`).join(''):'<div class=small>None</div>'}
      <br>
      <b>Demerits</b>${s.demerits.length? s.demerits.map(d=>`<div class='demerit'>‚Ä¢ ${d}</div>`).join(''):'<div class=small>None</div>'}
    </div>
  </div>`;
}
</script>
</body>
</html>
